<!DOCTYPE HTML><html lang="zh"><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>Component Metadata Protocol (WIP) · MAVLink Developer Guide</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="../../gitbook/style.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-anchors/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-language-picker/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-richquotes/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-highlight/website.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-theme-api/theme-api.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-theme-dronecode/theme_styles.css"rel="stylesheet"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="../../gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="../../gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="payload.html"rel="next"/><link href="high_latency.html"rel="prev"/></head><body><div id="common_dronecode_menu"><div class="large_version common_menu_logo"><a href="https://mavlink.io/en/"><img alt="Dronecode logo (large)"src="../../assets/site/logo_mavlink_header.png"/></a></div><div class="small_version common_menu_logo"><a href="https://mavlink.io/en/"><img alt="Dronecode logo (small)"src="../../assets/site/logo_mavlink_header.png"/></a></div><div class="common_menu_options"><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/messages/common.html">Messages</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/messages/common.html">Messages</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/faq.html">FAQ</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/faq.html">FAQ</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/implementations.html">Implementations</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/implementations.html">Implementations</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/mavgen_c/examples.html">Examples</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/mavgen_c/examples.html">Examples</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/support.html">Support</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/support.html">Help</a></div></div></div><div class="book"><div class="book-summary"><div id="book-search-input"role="search"><input placeholder="輸入並搜尋"type="text"/></div><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="../"><a href="../">简介</a><ul class="articles"><li class="chapter"data-level="1.1.1"data-path="../about/overview.html"><a href="../about/overview.html">Overview</a></li><li class="chapter"data-level="1.1.2"data-path="../about/faq.html"><a href="../about/faq.html">FAQ</a></li><li class="chapter"data-level="1.1.3"data-path="../about/implementations.html"><a href="../about/implementations.html">Implementations</a></li></ul></li><li class="chapter"data-level="1.2"data-path="../getting_started/"><a href="../getting_started/">Getting Started</a><ul class="articles"><li class="chapter"data-level="1.2.1"data-path="../getting_started/installation.html"><a href="../getting_started/installation.html">Install MAVLink</a></li><li class="chapter"data-level="1.2.2"data-path="../getting_started/generate_libraries.html"><a href="../getting_started/generate_libraries.html">Generate MAVLink Libraries</a></li><li class="chapter"data-level="1.2.3"data-path="../getting_started/ros.html"><a href="../getting_started/ros.html">Generate Source Files for ROS</a></li></ul></li><li class="chapter"data-level="1.3"data-path="../getting_started/use_libraries.html"><a href="../getting_started/use_libraries.html">Using MAVLink Libraries</a><ul class="articles"><li class="chapter"data-level="1.3.1"data-path="../mavgen_c/"><a href="../mavgen_c/">C (mavgen)</a><ul class="articles"><li class="chapter"data-level="1.3.1.1"data-path="../mavgen_c/message_signing_c.html"><a href="../mavgen_c/message_signing_c.html">Message Signing</a></li><li class="chapter"data-level="1.3.1.2"data-path="../mavgen_c/examples.html"><a href="../mavgen_c/examples.html">Examples</a><ul class="articles"><li class="chapter"data-level="1.3.1.2.1"data-path="../mavgen_c/example_c_uart.html"><a href="../mavgen_c/example_c_uart.html">UART Interface (C)</a></li><li class="chapter"data-level="1.3.1.2.2"data-path="../mavgen_c/example_c_udp.html"><a href="../mavgen_c/example_c_udp.html">UDP Example (C)</a></li></ul></li></ul></li><li class="chapter"data-level="1.3.2"data-path="../mavgen_python/"><a href="../mavgen_python/">Python (mavgen)</a></li></ul></li><li class="chapter"data-level="1.4"data-path="../guide/"><a href="../guide/">Guide</a><ul class="articles"><li class="chapter"data-level="1.4.1"data-path="../guide/mavlink_version.html"><a href="../guide/mavlink_version.html">MAVLink Versions</a></li><li class="chapter"data-level="1.4.2"data-path="../guide/mavlink_2.html"><a href="../guide/mavlink_2.html">MAVLink 2</a></li><li class="chapter"data-level="1.4.3"data-path="../guide/message_signing.html"><a href="../guide/message_signing.html">Message Signing</a></li><li class="chapter"data-level="1.4.4"data-path="../guide/serialization.html"><a href="../guide/serialization.html">Serialization</a></li><li class="chapter"data-level="1.4.5"data-path="../guide/routing.html"><a href="../guide/routing.html">Routing</a></li><li class="chapter"data-level="1.4.6"data-path="../guide/general_telemetry.html"><a href="../guide/general_telemetry.html">General Telemetry</a></li><li class="chapter"data-level="1.4.7"data-path="../guide/offboard_control.html"><a href="../guide/offboard_control.html">Offboard Control</a></li><li class="chapter"data-level="1.4.8"data-path="../file_formats/"><a href="../file_formats/">File Formats</a></li><li class="chapter"data-level="1.4.9"data-path="../guide/uavcan_interaction.html"><a href="../guide/uavcan_interaction.html">UAVCAN Interaction</a></li><li class="chapter"data-level="1.4.10"data-path="../guide/scripts.html"><a href="../guide/scripts.html">Scripts</a></li><li class="chapter"data-level="1.4.11"data-path="../guide/xml_schema.html"><a href="../guide/xml_schema.html">MAVLink XML Schema</a></li><li class="chapter"data-level="1.4.12"data-path="../guide/define_xml_element.html"><a href="../guide/define_xml_element.html">Defining XML Enums/Messages</a></li><li class="chapter"data-level="1.4.13"data-path="../guide/crc.html"><a href="../guide/crc.html">MAVLink CRC</a></li><li class="chapter"data-level="1.4.14"data-path="../guide/wireshark.html"><a href="../guide/wireshark.html">Debugging with Wireshark</a></li><li class="chapter"data-level="1.4.15"data-path="../messages/"><a href="../messages/">Dialects</a><ul class="articles"><li class="chapter"data-level="1.4.15.1"data-path="../messages/ASLUAV.html"><a href="../messages/ASLUAV.html">ASLUAV.xml</a></li><li class="chapter"data-level="1.4.15.2"data-path="../messages/all.html"><a href="../messages/all.html">all.xml</a></li><li class="chapter"data-level="1.4.15.3"data-path="../messages/ardupilotmega.html"><a href="../messages/ardupilotmega.html">ardupilotmega.xml</a></li><li class="chapter"data-level="1.4.15.4"data-path="../messages/autoquad.html"><a href="../messages/autoquad.html">autoquad.xml</a></li><li class="chapter"data-level="1.4.15.5"data-path="../messages/development.html"><a href="../messages/development.html">development.xml</a></li><li class="chapter"data-level="1.4.15.6"data-path="../messages/icarous.html"><a href="../messages/icarous.html">icarous.xml</a></li><li class="chapter"data-level="1.4.15.7"data-path="../messages/matrixpilot.html"><a href="../messages/matrixpilot.html">matrixpilot.xml</a></li><li class="chapter"data-level="1.4.15.8"data-path="../messages/minimal.html"><a href="../messages/minimal.html">minimal.xml</a></li><li class="chapter"data-level="1.4.15.9"data-path="../messages/paparazzi.html"><a href="../messages/paparazzi.html">paparazzi.xml</a></li><li class="chapter"data-level="1.4.15.10"data-path="../messages/python_array_test.html"><a href="../messages/python_array_test.html">python_array_test.xml</a></li><li class="chapter"data-level="1.4.15.11"data-path="../messages/standard.html"><a href="../messages/standard.html">standard.xml</a></li><li class="chapter"data-level="1.4.15.12"data-path="../messages/test.html"><a href="../messages/test.html">test.xml</a></li><li class="chapter"data-level="1.4.15.13"data-path="../messages/uAvionix.html"><a href="../messages/uAvionix.html">uAvionix.xml</a></li><li class="chapter"data-level="1.4.15.14"data-path="../messages/ualberta.html"><a href="../messages/ualberta.html">ualberta.xml</a></li></ul></li></ul></li><li class="chapter"data-level="1.5"data-path="../messages/common.html"><a href="../messages/common.html">Messages (common)</a></li><li class="chapter"data-level="1.6"data-path="./"><a href="./">Microservices</a><ul class="articles"><li class="chapter"data-level="1.6.1"data-path="heartbeat.html"><a href="heartbeat.html">Heartbeat/Connection Protocol</a></li><li class="chapter"data-level="1.6.2"data-path="mission.html"><a href="mission.html">Mission Protocol</a></li><li class="chapter"data-level="1.6.3"data-path="parameter.html"><a href="parameter.html">Parameter Protocol</a></li><li class="chapter"data-level="1.6.4"data-path="parameter_ext.html"><a href="parameter_ext.html">Extended Parameter Protocol</a></li><li class="chapter"data-level="1.6.5"data-path="command.html"><a href="command.html">Command Protocol</a></li><li class="chapter"data-level="1.6.6"data-path="manual_control.html"><a href="manual_control.html">Manual Control (Joystick) Protocol</a></li><li class="chapter"data-level="1.6.7"data-path="camera.html"><a href="camera.html">Camera Protocol</a><ul class="articles"><li class="chapter"data-level="1.6.7.1"data-path="camera_def.html"><a href="camera_def.html">Camera Definition</a></li></ul></li><li class="chapter"data-level="1.6.8"data-path="gimbal_v2.html"><a href="gimbal_v2.html">Gimbal Protocol v2</a><ul class="articles"><li class="chapter"data-level="1.6.8.1"data-path="gimbal.html"><a href="gimbal.html">Gimbal Protocol v1 (superseded)</a></li></ul></li><li class="chapter"data-level="1.6.9"data-path="arm_authorization.html"><a href="arm_authorization.html">Arm Authorization Protocol</a></li><li class="chapter"data-level="1.6.10"data-path="image_transmission.html"><a href="image_transmission.html">Image Transmission Protocol</a></li><li class="chapter"data-level="1.6.11"data-path="ftp.html"><a href="ftp.html">File Transfer Protocol (FTP)</a></li><li class="chapter"data-level="1.6.12"data-path="landing_target.html"><a href="landing_target.html">Landing Target Protocol</a></li><li class="chapter"data-level="1.6.13"data-path="ping.html"><a href="ping.html">Ping Protocol</a></li><li class="chapter"data-level="1.6.14"data-path="trajectory.html"><a href="trajectory.html">Path Planning (Trajectory) Protocol</a></li><li class="chapter"data-level="1.6.15"data-path="battery.html"><a href="battery.html">Battery Protocol</a></li><li class="chapter"data-level="1.6.16"data-path="terrain.html"><a href="terrain.html">Terrain Protocol</a></li><li class="chapter"data-level="1.6.17"data-path="tunnel.html"><a href="tunnel.html">Tunnel Protocol</a></li><li class="chapter"data-level="1.6.18"data-path="opendroneid.html"><a href="opendroneid.html">Open Drone ID Protocol (WIP)</a></li><li class="chapter"data-level="1.6.19"data-path="high_latency.html"><a href="high_latency.html">High Latency Protocol</a></li><li class="chapter active"data-level="1.6.20"data-path="component_information.html"><a href="component_information.html">Component Metadata Protocol (WIP)</a></li><li class="chapter"data-level="1.6.21"data-path="payload.html"><a href="payload.html">Payload Protocols</a></li><li class="chapter"data-level="1.6.22"data-path="traffic_management.html"><a href="traffic_management.html">Traffic Managment (UTM/ADS-B)</a></li><li class="chapter"data-level="1.6.23"data-path="events.html"><a href="events.html">Events Interface (WIP)</a></li></ul></li><li class="chapter"data-level="1.7"data-path="../contributing/contributing.html"><a href="../contributing/contributing.html">Contributing</a></li><li class="chapter"data-level="1.8"data-path="../about/support.html"><a href="../about/support.html">Support</a></li><li class="divider"></li><li><a href="https://www.gitbook.com"class="gitbook-link"target="blank">本書使用 GitBook 釋出</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><i class="fa fa-circle-o-notch fa-spin"></i> <a href="..">Component Metadata Protocol (WIP)</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><h1 id="component-metadata-protocol-wip"><a href="#component-metadata-protocol-wip"class="plugin-anchor"name="component-metadata-protocol-wip"><i class="fa fa-link"aria-hidden="true"></i></a>Component Metadata Protocol (WIP)</h1><blockquote class="alert clearfix alert-warning"><strong class="fa fa-2x fa-exclamation-triangle"></strong><p>This service is still marked as &quot;work in progress&quot;, and should not be relied upon in production. It has also evolved since first created as the &quot;Component Information Protocol&quot;.</p></blockquote><p>The <em>Component Metadata Protocol</em> is a MAVLink service for requesting metadata from (and about) MAVLink components. It is intended to provide autopilot- and version- independent feature discovery and configuration, allowing a GCS to configure its UI and/or a device without knowing anything about the connected system.</p><p>Information shared using this service may include:</p><ul><li>What types of component information are supported (by this component).</li><li>What MAVLink commands are supported (both in missions and in other modes).</li><li>Parameter metadata for parameters supported by the vehicle.</li><li>Metadata about events emitted by the system</li><li>Self-describing configuration UIs (i.e. similar to MAVLink camera configuration files).</li><li>Translations of other metadata.</li></ul><p>Component metadata is specified in <a href="#schema_files">appropriately formatted JSON files</a> (which may be <a href="#file-compression"><strong>.xz</strong> compressed</a>). The component metadata protocol is used to request the location of the <a href="#COMP_METADATA_TYPE_GENERAL">general metadata file</a> file, which is then parsed to get the location of other <a href="#schema_files">metadata files</a> supported by the component.</p><p>Information supplied by the service is assumed to be invariant after boot. There is no mechanism, for example, to provide an update if the set of supported parameters was to change after boot.</p><h2 id="messageenum-summary"><a href="#messageenum-summary"class="plugin-anchor"name="messageenum-summary"><i class="fa fa-link"aria-hidden="true"></i></a>Message/Enum Summary</h2><table><thead><tr><th>Message</th><th>Description</th></tr></thead><tbody><tr><td><a id="COMPONENT_METADATA"></a><a href="../messages/common.html#COMPONENT_METADATA">COMPONENT_METADATA</a></td><td>Message providing a download url and <a href="#metadata-caching-crc">CRC</a> for the <a href="#COMP_METADATA_TYPE_GENERAL">general metadata</a> component information file. The message is requested using <a href="#MAV_CMD_REQUEST_MESSAGE">MAV_CMD_REQUEST_MESSAGE</a>.</td></tr><tr><td><a id="MAV_CMD_REQUEST_MESSAGE"></a><a href="../messages/common.html#MAV_CMD_REQUEST_MESSAGE">MAV_CMD_REQUEST_MESSAGE</a></td><td>Use this command to request that a component emit <a href="#COMPONENT_METADATA">COMPONENT_METADATA</a>. Use <code>param1=397</code> (the message id of <code>COMPONENT_METADATA</code>).</td></tr></tbody></table><table><thead><tr><th>Enum</th><th>Description</th></tr></thead><tbody><tr><td><a id="COMP_METADATA_TYPE"></a><a href="../messages/common.html#COMP_METADATA_TYPE">COMP_METADATA_TYPE</a></td><td>Types of component metadata supported by the protocol - e.g. general information, parameter metadata, supported commands, events, peripherals, etc. The type identifiers are used in the &quot;general&quot; metadata file to identify the sections that provide information about each supported type of metadata.</td></tr></tbody></table><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p><a href="../messages/common.html#COMPONENT_INFORMATION">COMPONENT_INFORMATION</a> is not used by thie service (it is a deprecated legacy version of <a href="../messages/common.html#COMPONENT_METADATA">COMPONENT_METADATA</a>).</p></blockquote><h2 id="schema_files"><a href="#schema_files"class="plugin-anchor"name="schema_files"><i class="fa fa-link"aria-hidden="true"></i></a>Component Information File Format (Schema)</h2><p>Component information files are written in JSON and must conform to the schema definitions found in the folder <a href="https://github.com/mavlink/mavlink/tree/master/component_metadata"target="_blank">/component_metadata</a>. The component information file types and schema are (at time of writing):</p><table><thead><tr><th>Type</th><th>Type Id</th><th>Schema</th><th>Description</th></tr></thead><tbody><tr><td><a id="COMP_METADATA_TYPE_GENERAL"></a>General metadata</td><td><a href="../messages/common.html#COMP_METADATA_TYPE_GENERAL">COMP_METADATA_TYPE_GENERAL</a></td><td><a href="https://github.com/mavlink/mavlink/blob/master/component_metadata/general.schema.json"target="_blank">general.schema.json</a></td><td>General information about the component including hardware/firmware vendor version. This metadata includes information about all the other metadata types are supported by the component and where their metadata files are located. This metadata type must be supported if this protocol is supported and the file must be present on vehicle and delivered by MAVLink FTP. Note however that you never actually need to specify this type!</td></tr><tr><td><a id="COMP_METADATA_TYPE_PARAMETER"></a>Parameter metadata</td><td><a href="../messages/common.html#COMP_METADATA_TYPE_PARAMETER">COMP_METADATA_TYPE_PARAMETER</a></td><td><a href="https://github.com/mavlink/mavlink/blob/master/component_metadata/parameter.schema.json"target="_blank">parameter.schema.json</a></td><td>Information about parameters supported by the vehicle (on boot).</td></tr><tr><td><a id="COMP_METADATA_TYPE_COMMANDS"></a> Command protocol metadata</td><td><a href="../messages/common.html#COMP_METADATA_TYPE_COMMANDS">COMP_METADATA_TYPE_COMMANDS</a></td><td>TBD</td><td>Information about which commands and command paramters are supported in via the command protocol.</td></tr><tr><td><a id="COMP_METADATA_TYPE_PERIPHERALS"></a> Peripheral metadata</td><td><a href="../messages/common.html#COMP_METADATA_TYPE_PERIPHERALS">COMP_METADATA_TYPE_PERIPHERALS</a></td><td><a href="https://github.com/mavlink/mavlink/blob/master/component_metadata/peripherals.schema.json"target="_blank">peripherals.schema.json</a></td><td>Information about non-MAVLink peripherals connected to vehicle (on boot).</td></tr><tr><td><a id="COMP_METADATA_TYPE_EVENTS"></a> Event metadata</td><td><a href="../messages/common.html#COMP_METADATA_TYPE_EVENTS">COMP_METADATA_TYPE_EVENTS</a></td><td>TBD</td><td>Information about events interface support by the vehicle.</td></tr><tr><td><a id="COMP_METADATA_TYPE_ACTUATORS"></a> Event metadata</td><td><a href="../messages/common.html#COMP_METADATA_TYPE_ACTUATORS">COMP_METADATA_TYPE_ACTUATORS</a></td><td><a href="https://github.com/mavlink/mavlink/blob/master/component_metadata/actuators.schema.json"target="_blank">actuators.schema.json</a></td><td>Metadata for actuator configuration (motors, servos and vehicle geometry) and testing.</td></tr></tbody></table><p>All schema files are <em>versioned</em> using a <code>version</code> integer.</p><p>Schema versions are backwards compatible - i.e. a ground station that was able to populate its UI from a file based on an older schema should be able to do so from a newer version (albeit losing information provided by the newer format).</p><p>Generally this means that new versions may add fields but should not delete them, and also that a recipient can ignore fields that it does not understand.</p><p>The schema are currently a work in progress and can be modified as needed. Once accepted, they will be under change control (<em>managed</em> in a similar way to standard MAVLink messages).</p><h2 id="file-locationsurls"><a href="#file-locationsurls"class="plugin-anchor"name="file-locationsurls"><i class="fa fa-link"aria-hidden="true"></i></a>File Locations/URLs</h2><p><a href="#COMP_METADATA_TYPE_GENERAL">General metadata</a> files <em>must</em> be stored on the device, and will usually be <a href="#file-compression"><strong>.xz</strong> compressed</a>. The location of these files is returned in the <a href="#COMPONENT_METADATA">COMPONENT_METADATA</a> <code>uri</code> field.</p><p>Other component information files may be hosted on either the device or on the internet.</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>Where permitted by memory constraints you should host component information on the device (so that it is always available and cannot get out of sync).</p></blockquote><p>Files on the device are downloaded using <a href="ftp.html">MAVLink FTP</a>. The URI format is defined in <a href="ftp.html#mavlink-ftp-url-scheme">MAVLink FTP URL Scheme</a>. A typical parameter metadata URI might look like this: <code>mftp:///component_metadata/parameters.json.xz</code>.</p><p>Files on the Internet are downloaded using HTTPS or HTTP via a normal web URL (e.g. <code>https://some_domain/component_metadata/parameters.json</code>).</p><h2 id="metadata-caching-crc"><a href="#metadata-caching-crc"class="plugin-anchor"name="metadata-caching-crc"><i class="fa fa-link"aria-hidden="true"></i></a>Metadata Caching (CRC)</h2><p>The <a href="#COMPONENT_METADATA">COMPONENT_METADATA</a> message includes the <code>file_crc</code> field, which contain <a href="../crc.md#crc32-algorithm">CRC32</a> values calculated for the file referenced in the <code>uri</code> field. A ground station should cache downloaded component metadata and only update it if the CRC value changes.</p><p>The <a href="#COMP_METADATA_TYPE_GENERAL">general metadata file</a> similarly provides file locations for other metadata supported by a component. It will also include <a href="../crc.md#crc32-algorithm">CRC32</a> values any files that contain only static data (no CRC32 should be supplied for metadata files that might be updated dynamically).</p><h2 id="file-compression"><a href="#file-compression"class="plugin-anchor"name="file-compression"><i class="fa fa-link"aria-hidden="true"></i></a>File Compression</h2><p>Component information files may be <strong>.xz</strong> compressed (this is recommended for files that are hosted on the device).</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>The prototype implementation generates and compresses component information files at build time. No compression library is required within the flight stack itself.</p></blockquote><p><span></span></p><blockquote class="alert clearfix alert-warning"><strong class="fa fa-2x fa-exclamation-triangle"></strong><p>Systems that <em>request</em> component information <strong>must</strong> support extraction of <strong>.xz</strong>-compressed JSON files.</p></blockquote><p><span></span></p><blockquote class="alert clearfix alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong><p>The <a href="https://tukaani.org/xz/embedded.html"target="_blank">Tukaani Project XZ Embedded</a> library is an easy-to-use XZ compression library for embedded systems and cross-platform C/C++ projects.</p></blockquote><h2 id="sequences"><a href="#sequences"class="plugin-anchor"name="sequences"><i class="fa fa-link"aria-hidden="true"></i></a>Sequences</h2><h3 id="component-discovery"><a href="#component-discovery"class="plugin-anchor"name="component-discovery"><i class="fa fa-link"aria-hidden="true"></i></a>Component Discovery</h3><p>A GCS can <em>broadcast</em> the <code>MAV_CMD_REQUEST_MESSAGE</code> specifying <code>param1=397</code>; all components that support the protocol should respond with <code>COMPONENT_METADATA</code>.</p><p>A GCS can further discover all components in the system by monitoring the channel for <code>HEARTBEAT</code> ids, and then send the request to each of them to <a href="#check-protocol-is-supported">verify whether the protocol is supported</a>. The broadcast approach is recommended for GCSes that don&apos;t track all components on the link.</p><h3 id="check-if-protocol-is-supported"><a href="#check-if-protocol-is-supported"class="plugin-anchor"name="check-if-protocol-is-supported"><i class="fa fa-link"aria-hidden="true"></i></a>Check if Protocol is Supported</h3><p>A system can query whether another component supports the protocol by sending the command <a href="../messages/common.html#MAV_CMD_REQUEST_MESSAGE">MAV_CMD_REQUEST_MESSAGE</a> (specifying the <a href="../messages/common.html#COMPONENT_METADATA">COMPONENT_METADATA</a> message).</p><p>The component will respond with <code>COMPONENT_METADATA.uri</code> containing a valid URI if the protocol is supported. If the protocol is not supported the component will ACK that the message with <code>MAV_RESULT_UNSUPPORTED</code>, <code>MAV_RESULT_DENIED</code> or <code>MAV_RESULT_FAILED</code>, or return a <code>null</code> value in <code>uri</code>.</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>A component that supports this service must return a general metadata file URI <em>that is hosted on the vehicle</em> (accessed using MAVLink FTP).</p></blockquote><h3 id="get-metadata"><a href="#get-metadata"class="plugin-anchor"name="get-metadata"><i class="fa fa-link"aria-hidden="true"></i></a>Get MetaData</h3><p>The basic sequence is shown below.</p><p><a href="https://mermaid-js.github.io/mermaid-live-editor/edit#pako:eNqVUt9r2zAQ_lcOPaWQFUofytwtYBy3jJG0i9M9GcJVOidiluTK54xS-r_vXLtZSym0fpH16ftxOt2D0sGQSlRLdx15TXOL24juvPQgX4ORrbYNeoastuT5LV5Q3FMc8GVggiDbEZ2OquSwrvqclkEH1wQvEFhfheiQbfDHg8vA_TKbDSYJLNLfm2wx36zyXzd5sd4s8qJIL_OJlIHu5Pvp17OjV0qRPucVLKVCmv2ESJrsnoCto9CNF4Gx0BeKPkj4759fLa6vlvmyL2OdztN1OoEu2ilUtqaNjvroY70AvSP950kFyL0F7LAVFP2WDEy61votZKtMOvTf-xg-6G7CX18HNK8CBk9p58X6GtCb_iFb-rxn4J2wHDEaZAS-b6iVBlcU-xkyfcVb8hSxPpC-3cYZTKoYHBjaWy1JEX54puiJD9eCYVVT5UiGwhoZzYceKpVEOipVIr-GKuxqLlXpH4XaNRJAubEcokoqrFuaKuw4FPdeq4RjR8-kcbxH1uM_z7kA6w"target="_blank"><img alt=""src="https://mermaid.ink/img/pako:eNqVUt9r2zAQ_lcOPaWQFUofytwtYBy3jJG0i9M9GcJVOidiluTK54xS-r_vXLtZSym0fpH16ftxOt2D0sGQSlRLdx15TXOL24juvPQgX4ORrbYNeoastuT5LV5Q3FMc8GVggiDbEZ2OquSwrvqclkEH1wQvEFhfheiQbfDHg8vA_TKbDSYJLNLfm2wx36zyXzd5sd4s8qJIL_OJlIHu5Pvp17OjV0qRPucVLKVCmv2ESJrsnoCto9CNF4Gx0BeKPkj4759fLa6vlvmyL2OdztN1OoEu2ilUtqaNjvroY70AvSP950kFyL0F7LAVFP2WDEy61votZKtMOvTf-xg-6G7CX18HNK8CBk9p58X6GtCb_iFb-rxn4J2wHDEaZAS-b6iVBlcU-xkyfcVb8hSxPpC-3cYZTKoYHBjaWy1JEX54puiJD9eCYVVT5UiGwhoZzYceKpVEOipVIr-GKuxqLlXpH4XaNRJAubEcokoqrFuaKuw4FPdeq4RjR8-kcbxH1uM_z7kA6w"></a></p><p>In summary:</p><ol><li>GCS (client) sends <code>MAV_CMD_REQUEST_MESSAGE</code> to component (server) specifying <code>param1=397</code>.<ul><li>This is a normal <a href="command.html">command protocol</a> request with timeouts and resends based on the ACK.</li></ul></li><li>The component will ACK the command and immediately send the requested <code>COMPONENT_METADATA</code> message (populated with URI and CRC for the general metadata file).<ul><li>A <code>CMD_ACK</code> of anything other than <code>MAV_RESULT_ACCEPTED</code> indicates the protocol is not supported (sequence completes).</li></ul></li><li>GCS waits for the <code>COMPONENT_METADATA</code> message<ul><li>If not recieved the GCS should resend the request (typically in the application level).</li><li>Once information is received:<ul><li>the GCS checks if <code>COMPONENT_METADATA.file_crc</code> matches its cached CRC value. If so, there is no need to download the <a href="#COMP_METADATA_TYPE_GENERAL">general metadata file</a> (or other files it references) as it has not changed since the last download. If the cached values do not match the associated files should be downloaded and parsed (vehicle firmware has updated).</li></ul></li></ul></li><li>GCS downloads the file specified in the <code>uri</code> using MAVLink FTP.</li><li>GCS parses the general metadata for other supported metadata locations, and then downloads the files via MAVFTP or HTTP(s). This may be done immediately, or as needed.</li></ol><h2 id="metadata-types"><a href="#metadata-types"class="plugin-anchor"name="metadata-types"><i class="fa fa-link"aria-hidden="true"></i></a>Metadata Types</h2><h3 id="actuators-compmetadatatypeactuators"><a href="#actuators-compmetadatatypeactuators"class="plugin-anchor"name="actuators-compmetadatatypeactuators"><i class="fa fa-link"aria-hidden="true"></i></a>Actuators (COMP_METADATA_TYPE_ACTUATORS)</h3><p>The actuators metadata allows a GCS to create a UI to configure and test actuators, and configure vehicle geometries, without having to understand anything about the underlying flight stack.</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>The mechanism works similarly to <a href="camera_def.html">camera definition files</a>. It can be used for flight stacks that allow outputs and geometry definition to be configured using parameters. If flight stack outputs or geometries cannot be configured using parameters, the mechanism can still be used to display the current geometry and output mappings, and to test outputs.</p></blockquote><p>The definition contains information about actuator output drivers (e.g. PWM MAIN or UAVCAN), the functions that can be assigned to each output channel, supported geometries, and their configuration parameters. Detailed information can be found in the <a href="https://github.com/mavlink/mavlink/blob/master/component_metadata/actuators.schema.json"target="_blank">schema file</a>, and there&apos;s also an <a href="https://github.com/mavlink/mavlink/blob/master/component_metadata/actuators.example.json"target="_blank">example</a>.</p><p>Specifically, the following information is provided:</p><ul><li><p>A list of actuator output drivers (e.g. PWM MAIN or UAVCAN): <code>outputs_v1</code>. This can be hardware-specific. Each output driver contains one or more groups of output channels. A group contains a common set of configuration parameters, indexed for each channel. A parameter may be assigned a specific meaning, e.g. <code>disarmed</code>. A GCS can use this information to provide specific actions for these (without having to know all <code>disarmed</code> parameters a priori).</p></li><li><p>Actuator output functions: <code>functions_v1</code>. A list of the output functions (hardware) that can be connected to a particular output channel, for example: Motor 1, Landing Gear, Camera capture. Each actuator output channel is expected to provide a parameter that can be used to configure its output function.</p></li><li><p>A geometry/mixer section: <code>mixer_v1</code>. A list of frame geometries, where at most one geometry is selected (via parameter), and a list of actuator types. An actuator type (e.g. <code>servo</code> or <code>motor</code>) contains limits and defaults for actuator testing, and a set of output function values that can be assigned to this type. A GCS may use the type to render the geometry, so it can display different images depending on the type.</p><p>Each mixer contains one or more groups of actuators, where each group belongs to an actuator type. The group can contain a fixed or configurable number of actuators and a set of indexed configuration parameters. If the size is fixed, the actuator group can contain lists of fixed values, e.g. to provide position information for non-configurable actuators. As with the actuator outputs, parameters may be assigned a specific meaning, e.g. <code>posx</code>, which hints to the GCS that this parameter/value defines the x position of the actuator. This can be used to dynamically render a vehicle&apos;s geometry.</p><p>Additionally there is an optional list of rules. Rules are used to constrain or hide/disable geometry parameters depending on the value of a selection parameter. For example there could be a parameter to select the control surface type, and three parameters to configure the roll, pitch and yaw torque. When the user sets the type to &apos;Left Aileron&apos;, certain restrictions to roll and pitch torque are applied, and the yaw torque is hidden.</p></li></ul><p>A GCS can provide a UI for testing outputs based on the configured output functions, by iterating over all output channels and collecting the configured actuator output functions, and then utilizing the <code>MAV_CMD_ACTUATOR_TEST</code> command.</p><h2 id="open-issues"><a href="#open-issues"class="plugin-anchor"name="open-issues"><i class="fa fa-link"aria-hidden="true"></i></a>Open Issues</h2><h3 id="translations"><a href="#translations"class="plugin-anchor"name="translations"><i class="fa fa-link"aria-hidden="true"></i></a>Translations</h3><p>The proposal is:</p><ul><li>File format be Qt&apos;s <code>.ts</code> file format, wrapped in a custom container format.</li><li>General metadata will contain the location of translation file URIs, but not their CRC.</li><li>A GCS or other system that needs translation data is expected to poll for it and download it regularly (e.g. on boot). If it is not possible to detect the file has changed on the server, a GCS should update anyway on a regular basis.</li></ul><p>This is being prototyped. Once there is a working version, the approach will be documented here.</p><h3 id="schema-management"><a href="#schema-management"class="plugin-anchor"name="schema-management"><i class="fa fa-link"aria-hidden="true"></i></a>Schema Management</h3><p>Schema <em>management</em> has not yet been signed off.</p><h3 id="guaranteed-availablility-of-component-information"><a href="#guaranteed-availablility-of-component-information"class="plugin-anchor"name="guaranteed-availablility-of-component-information"><i class="fa fa-link"aria-hidden="true"></i></a>Guaranteed Availablility of Component Information</h3><p>There is a concern that vehicles reliant on internet-hosted component information files may stop working if the hosting ceases.</p><p>This can generally be avoided by hosting the files compressed on-vehicle.</p><p>We propose that manufacturers that use autopilots with limited flash (1MB or below) and do custom firmware development should host the files in github.</p></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1><ul class="search-results-list"></ul></div><div class="no-results"><h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1></div></div></div></div></div></div></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{title:"Component Metadata Protocol (WIP)",level:"1.6.20",depth:2,next:{title:"Payload Protocols",level:"1.6.21",depth:2,path:"services/payload.md",ref:"services/payload.md",articles:[]},previous:{title:"High Latency Protocol",level:"1.6.19",depth:2,path:"services/high_latency.md",ref:"services/high_latency.md",articles:[]},dir:"ltr"},config:{plugins:["theme-api","youtube","anchors","collapsible-menu","page-toc-button","language-picker","custom-favicon","richquotes@git+https://github.com/Dronecode/gitbook-plugin-richquotes.git","bulk-redirect@git+https://github.com/Dronecode/gitbook-plugin-bulk-redirect.git","toolbar@git+https://github.com/hamishwillee/gitbook-plugin-toolbar.git","-mermaid","theme-dronecode@git+https://github.com/dronecode/theme-dronecode.git","html-minifier"],styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},pluginsConfig:{"theme-dronecode":{logo:{logo_large:"../assets/site/logo_mavlink_header.png",logo_small:"../assets/site/logo_mavlink_header.png",url:"https://mavlink.io/en/"},menu:[{url:"https://mavlink.io/en/messages/common.html",text:"Messages",text_small:"Messages"},{url:"https://mavlink.io/en/about/faq.html",text:"FAQ",text_small:"FAQ"},{url:"https://mavlink.io/en/about/implementations.html",text:"Implementations",text_small:"Implementations"},{url:"https://mavlink.io/en/mavgen_c/examples.html",text:"Examples",text_small:"Examples"},{url:"https://mavlink.io/en/about/support.html",text:"Support",text_small:"Help"}]},"collapsible-menu":{},"language-picker":{"grid-columns":3},youtube:{},search:{},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!1,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},fontsettings:{theme:"white",family:"sans",size:2},richquotes:{tip:{alert:"success",picto:"fa-thumbs-o-up"}},highlight:{},favicon:"favicon.ico","page-toc-button":{},"theme-api":{languages:[{lang:"c",name:"C/C++",default:!0},{lang:"python",name:"Python"},{lang:"js",name:"JavaScript"},{lang:"go",name:"Go"}],split:!0,theme:"light"},"bulk-redirect":{basepath:"/",redirectsFile:"redirects.json"},"custom-favicon":{},toolbar:{buttons:[{label:"Bug tracker",icon:"fa fa-bug",position:"left",url:"https://github.com/mavlink/mavlink-devguide/issues/new?title=Doc+Bug:+{{title}}&body=DESCRIBE+PROBLEM+WITH+DOCS+HERE%0A%0ABug+Page:+[{{title}}]({{url}})"},{label:"GitHub",icon:"fa fa-github",url:"https://github.com/mavlink/mavlink-devguide"},{label:"Edit page on github",icon:"fa fa-pencil-square-o",position:"left",url:"https://github.com/mavlink/mavlink-devguide/edit/master/{{filepath_lang}}"}]},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1},anchors:{}},theme:"default",pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{logo:"./assets/site/logo_mavlink_small.png"},title:"MAVLink Developer Guide",language:"zh",gitbook:"*"},file:{path:"services/component_information.md",mtime:"2022-06-18T00:55:14.243Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2022-06-18T00:56:02.587Z"},basePath:"..",book:{language:"zh"}})})</script></div><script src="../../gitbook/gitbook.js"></script><script src="../../gitbook/theme.js"></script><script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script><script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script><script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script><script src="../../gitbook/gitbook-plugin-toolbar/buttons.js"></script><script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script><script src="../../gitbook/gitbook-plugin-search/search.js"></script><script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script><script src="../../gitbook/gitbook-plugin-theme-api/theme-api.js"></script></body></html>