import{_ as t,a as i,b as a}from"./chunks/xtrack_30.Dn4j9If5.js";import{_ as o,c as s,a8 as n,o as r}from"./chunks/framework.sDsl5pD6.js";const g=JSON.parse('{"title":"Mission Protocol","description":"","frontmatter":{},"headers":[],"relativePath":"zh/services/mission.md","filePath":"zh/services/mission.md"}'),d={name:"zh/services/mission.md"};function l(m,e,h,c,u,p){return r(),s("div",null,e[0]||(e[0]=[n('<h1 id="mission-protocol" tabindex="-1">Mission Protocol <a class="header-anchor" href="#mission-protocol" aria-label="Permalink to &quot;Mission Protocol&quot;">​</a></h1><p>The mission sub-protocol allows a GCS or developer API to exchange <em>mission</em> (flight plan), <em>geofence</em> and <em>safe point</em> information with a drone/component.</p><p>The protocol covers:</p><ul><li>Operations to upload, download and clear missions, set/get the current mission item number, and get notification when the current mission item has changed.</li><li>Message type(s) and enumerations for exchanging mission items.</li><li>Mission Items (&quot;MAVLink commands&quot;) that are common to most systems.</li></ul><p>The protocol supports re-request of messages that have not arrived, which allows missions to be reliably transferred over a lossy link.</p><h2 id="mission_types" tabindex="-1">Mission Types <a class="header-anchor" href="#mission_types" aria-label="Permalink to &quot;Mission Types {#mission_types}&quot;">​</a></h2><p>MAVLink 2 supports three types of &quot;missions&quot;: flight plans, geofences and rally/safe points. The protocol uses the same sequence of operations for all types (albeit with different types of <a href="#mavlink_commands">Mission Items</a>). The mission types must be stored and handled separately/independently.</p><p>Mission protocol messages include the type of associated mission in the <code>mission_type</code> field (a MAVLink 2 message extension). The field takes one of the <a href="./../messages/common.html#MAV_MISSION_TYPE">MAV_MISSION_TYPE</a> enum values: <a href="./../messages/common.html#MAV_MISSION_TYPE_MISSION">MAV_MISSION_TYPE_MISSION</a>, <a href="./../messages/common.html#MAV_MISSION_TYPE_FENCE">MAV_MISSION_TYPE_FENCE</a>, <a href="./../messages/common.html#MAV_MISSION_TYPE_RALLY">MAV_MISSION_TYPE_RALLY</a>.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>MAVLink 1 supports only &quot;regular&quot; flight-plan missions (this is implied/not explicitly set).</p></div><h2 id="mavlink_commands" tabindex="-1">Mission Items (MAVLink Commands) <a class="header-anchor" href="#mavlink_commands" aria-label="Permalink to &quot;Mission Items (MAVLink Commands) {#mavlink_commands}&quot;">​</a></h2><p>Mission items for all the <a href="#mission_types">mission types</a> are defined in the <a href="./../messages/common.html#mav_commands">MAV_CMD</a> enum.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p><a href="./../messages/common.html#mav_commands">MAV_CMD</a> is used to define commands that can be used in missions (&quot;mission items&quot;) and commands that can be sent outside of a mission context (using the <a href="./../services/command.html">Command Protocol</a>). Some <code>MAV_CMD</code> can be used with both mission and command protocols. Not all commands/mission items are supported on all systems (or for all flight modes).</p></div><p>The items for the different types of mission are identified using a simple name prefix convention:</p><ul><li><em>Flight plans</em>: <ul><li>NAV commands (<code>MAV_CMD_NAV_*</code>) for navigation/movement (e.g. <a href="./../messages/common.html#MAV_CMD_NAV_WAYPOINT">MAV_CMD_NAV_WAYPOINT</a>, <a href="./../messages/common.html#MAV_CMD_NAV_LAND">MAV_CMD_NAV_LAND</a>)</li><li>DO commands (<code>MAV_CMD_DO_*</code>) for immediate actions like changing speed or activating a servo (e.g. <a href="./../messages/common.html#MAV_CMD_DO_CHANGE_SPEED">MAV_CMD_DO_CHANGE_SPEED</a>).</li><li>CONDITION commands (<code>MAV_CMD_CONDITION_*</code>) for changing the execution of the mission based on a condition - e.g. pausing the mission for a time before executing next command (<a href="./../messages/common.html#MAV_CMD_CONDITION_DELAY">MAV_CMD_CONDITION_DELAY</a>).</li></ul></li><li><em>Geofence mission items</em>: <ul><li>Prefixed with <code>MAV_CMD_NAV_FENCE_</code> (e.g. <a href="./../messages/common.html#MAV_CMD_NAV_FENCE_RETURN_POINT">MAV_CMD_NAV_FENCE_RETURN_POINT</a>).</li></ul></li><li><em>Rally point mission items</em>: <ul><li>There is just one rally point <code>MAV_CMD</code>: <a href="./../messages/common.html#MAV_CMD_NAV_RALLY_POINT">MAV_CMD_NAV_RALLY_POINT</a>.</li></ul></li></ul><p>Mission items (<code>MAV_CMD</code>) are transmitted/encoded in <a href="#MISSION_ITEM_INT">MISSION_ITEM_INT</a> messages. This message includes fields to identify the particular mission item (command id) and up to 7 command-specific optional parameters.</p><table tabindex="0"><thead><tr><th>Field Name</th><th>Type</th><th>值</th><th>描述</th></tr></thead><tbody><tr><td>command</td><td>uint16_t</td><td><a href="./../messages/common.html#mav_commands">MAV_CMD</a></td><td>Command id, as defined in <a href="./../messages/common.html#mav_commands">MAV_CMD</a>.</td></tr><tr><td>param1</td><td>float</td><td></td><td>Param #1.</td></tr><tr><td>param2</td><td>float</td><td></td><td>Param #2.</td></tr><tr><td>param3</td><td>float</td><td></td><td>Param #3.</td></tr><tr><td>param4</td><td>float</td><td></td><td>Param #4.</td></tr><tr><td>param5 (x)</td><td>int32_t</td><td></td><td>X coordinate (local frame) or latitude (global frame) for navigation commands (otherwise Param #5).</td></tr><tr><td>param6 (y)</td><td>int32_t</td><td></td><td>Y coordinate (local frame) or longitude (global frame) for navigation commands (otherwise Param #6).</td></tr><tr><td>param7 (z)</td><td>float</td><td></td><td>Z coordinate (local frame) or altitude (global - relative or absolute, depending on frame) (otherwise Param #7).</td></tr></tbody></table><p>The first four parameters (shown above) can be used for any purpose - this depends on the particular <a href="./../messages/common.html#mav_commands">command</a>. The last three parameters (x, y, z) are used for positional information in <code>MAV_CMD_NAV_*</code> commands, but can be used for any purpose in other commands.</p><p>The remaining message fields are used for addressing, defining the mission type, specifying the reference frame used for x, y, z in <code>MAV_CMD_NAV_*</code> messages, etc.:</p><table tabindex="0"><thead><tr><th>Field Name</th><th>Type</th><th>值</th><th>描述</th></tr></thead><tbody><tr><td>target_system</td><td>uint8_t</td><td></td><td>System ID</td></tr><tr><td>target_component</td><td>uint8_t</td><td></td><td>Component ID</td></tr><tr><td>seq</td><td>uint16_t</td><td></td><td>Sequence number for item within mission (indexed from 0).</td></tr><tr><td>frame</td><td>uint8_t</td><td><a href="#MAV_FRAME">MAV_FRAME</a></td><td>| | frame | uint8_t | <a href="#MAV_FRAME">MAV_FRAME</a> | The coordinate system of the waypoint.<br> ArduPilot and PX4 both only support global frames in MAVLink commands (local frames may be supported if the same command is sent via the command protocol).</td></tr><tr><td>mission_type</td><td>uint8_t</td><td><a href="#MAV_MISSION_TYPE">MAV_MISSION_TYPE</a></td><td><a href="#mission_types">Mission type</a>.</td></tr><tr><td>current</td><td>uint8_t</td><td>false:0, true:1</td><td>When downloading, whether the item is the current mission item.</td></tr><tr><td>autocontinue</td><td>uint8_t</td><td></td><td>Autocontinue to next waypoint when the command completes.</td></tr></tbody></table><h2 id="message-enum-summary" tabindex="-1">Message/Enum Summary <a class="header-anchor" href="#message-enum-summary" aria-label="Permalink to &quot;Message/Enum Summary&quot;">​</a></h2><p>The following messages and enums are used by the service.</p><table tabindex="0"><thead><tr><th>消息</th><th>描述</th></tr></thead><tbody><tr><td><a id="MISSION_REQUEST_LIST"></a><a href="./../messages/common.html#MISSION_REQUEST_LIST">MISSION_REQUEST_LIST</a></td><td>Initiate <a href="#download_mission">mission download</a> from a system by requesting the list of mission items.</td></tr><tr><td><a id="MISSION_COUNT"></a><a href="./../messages/common.html#MISSION_COUNT">MISSION_COUNT</a></td><td>Send the number of items in a mission. This is used to initiate <a href="#uploading_mission">mission upload</a> or as a response to <a href="#MISSION_REQUEST_LIST">MISSION_REQUEST_LIST</a> when <a href="#download_mission">downloading a mission</a>.</td></tr><tr><td><a id="MISSION_REQUEST_INT"></a><a href="./../messages/common.html#MISSION_REQUEST_INT">MISSION_REQUEST_INT</a></td><td>Request mission item data for a specific sequence number be sent by the recipient using a <a href="#MISSION_ITEM_INT">MISSION_ITEM_INT</a> message. Used for mission <a href="#uploading_mission">upload</a> and <a href="#download_mission">download</a>.</td></tr><tr><td><a id="MISSION_ITEM_INT"></a><a href="./../messages/common.html#MISSION_ITEM_INT">MISSION_ITEM_INT</a></td><td>Message encoding a <a href="#mavlink_commands">mission item/command</a> (defined in a <a href="#MAV_CMD">MAV_CMD</a>). Used for mission <a href="#uploading_mission">upload</a> and <a href="#download_mission">download</a>.</td></tr><tr><td><a id="MISSION_ACK"></a><a href="./../messages/common.html#MISSION_ACK">MISSION_ACK</a></td><td>Acknowledgment message when a system completes a <a href="#operations">mission operation</a> (e.g. sent by autopilot after it has uploaded all mission items). The message includes a <a href="#MAV_MISSION_RESULT">MAV_MISSION_RESULT</a> indicating either success or the type of failure.</td></tr><tr><td><a id="MISSION_CURRENT"></a><a href="./../messages/common.html#MISSION_CURRENT">MISSION_CURRENT</a></td><td>Message containing the current mission item sequence number. This is streamed and also emitted when the <a href="#current_mission_item">current mission item is set/changed</a>.</td></tr><tr><td><a id="MISSION_SET_CURRENT"></a><a href="./../messages/common.html#MISSION_SET_CURRENT">MISSION_SET_CURRENT</a></td><td><a href="#current_mission_item">Set the current mission item</a> by sequence number (continue to this item on the shortest path).</td></tr><tr><td><a id="STATUSTEXT"></a><a href="./../messages/common.html#STATUSTEXT">STATUSTEXT</a></td><td>Sent to notify systems when a request to <a href="#current_mission_item">set the current mission item</a> fails.</td></tr><tr><td><a id="MISSION_CLEAR_ALL"></a><a href="./../messages/common.html#MISSION_CLEAR_ALL">MISSION_CLEAR_ALL</a></td><td>Message sent to <a href="#clear_mission">clear/delete all mission items</a> stored on a system.</td></tr><tr><td><a id="MISSION_ITEM_REACHED"></a><a href="./../messages/common.html#MISSION_ITEM_REACHED">MISSION_ITEM_REACHED</a></td><td>Message emitted by system whenever it reaches a new waypoint. Used to <a href="#monitor_progress">monitor progress</a>.</td></tr></tbody></table><table tabindex="0"><thead><tr><th>Command</th><th>描述</th></tr></thead><tbody><tr><td><a id="MAV_CMD_DO_SET_MISSION_CURRENT"></a><a href="./../messages/common.html#MAV_CMD_DO_SET_MISSION_CURRENT">MAV_CMD_DO_SET_MISSION_CURRENT</a></td><td>Set current mission item and optionally reset mission counter. Supersedes <a href="#MISSION_SET_CURRENT">MISSION_SET_CURRENT</a>.</td></tr></tbody></table><table tabindex="0"><thead><tr><th>Enum</th><th>描述</th></tr></thead><tbody><tr><td><a id="MAV_MISSION_TYPE"></a><a href="./../messages/common.html#MAV_MISSION_TYPE">MAV_MISSION_TYPE</a></td><td><a href="#mission_types">Mission type</a> for message (mission, geofence, rallypoints).</td></tr><tr><td><a id="MAV_MISSION_RESULT"></a><a href="./../messages/common.html#MAV_MISSION_RESULT">MAV_MISSION_RESULT</a></td><td>Used to indicate the success or failure reason for an operation (e.g. to upload or download a mission). This is carried in a <a href="#MISSION_ACK">MISSION_ACK</a>.</td></tr><tr><td><a id="MAV_FRAME"></a><a href="./../messages/common.html#MAV_FRAME">MAV_FRAME</a></td><td>Co-ordinate frame for position/velocity/acceleration data in the message.</td></tr><tr><td><a id="MAV_CMD"></a><a href="./../messages/common.html#mav_commands">MAV_CMD</a></td><td><a href="#mavlink_commands">Mission Items</a> (and MAVLink commands) sent in <a href="#MISSION_ITEM_INT">MISSION_ITEM_INT</a>.</td></tr></tbody></table><h2 id="command_message_type" tabindex="-1">Deprecated Types: MISSION_ITEM <a class="header-anchor" href="#command_message_type" aria-label="Permalink to &quot;Deprecated Types: MISSION_ITEM {#command_message_type}&quot;">​</a></h2><p>The legacy version of the protocol also supported <a href="./../messages/common.html#MISSION_REQUEST">MISSION_REQUEST</a> for requesting that a mission be sent as a sequence of <a href="./../messages/common.html#MISSION_ITEM">MISSION_ITEM</a> messages.</p><p>Both <code>MISSION_REQUEST</code> and <code>MISSION_ITEM</code> messages are now deprecated, and should no longer be sent. If <code>MISSION_REQUEST</code> is recieved the system should instead respond with <a href="#MISSION_ITEM_INT">MISSION_ITEM_INT</a> items (as though it received <a href="#MISSION_REQUEST_INT">MISSION_REQUEST_INT</a>).</p><h2 id="frames-positional-information" tabindex="-1">Frames &amp; Positional Information <a class="header-anchor" href="#frames-positional-information" aria-label="Permalink to &quot;Frames &amp; Positional Information&quot;">​</a></h2><p>By convention, mission items use <code>param5</code>, <code>param6</code>, <code>param7</code> for positional information when needed (and otherwise as &quot;free use&quot; parameters). The table below shows that the positional parameters can be local (x, y, z), global (latitude, longitude, altitude), and also the data type used to store the parameters in the <code>MISSION_ITEM_INT</code> message.</p><table tabindex="0"><thead><tr><th>参数</th><th>type</th><th>Local</th><th>Global</th></tr></thead><tbody><tr><td>param5</td><td><code>int32_t</code></td><td>x</td><td>Latitude</td></tr><tr><td>param6</td><td><code>int32_t</code></td><td>y</td><td>Longitude</td></tr><tr><td>param7</td><td><code>float</code></td><td>z</td><td>Altitude (global - relative or absolute)</td></tr></tbody></table><p>The co-ordinate frame of positional parameters is defined in the <code>MISSION_ITEM_INT.frame</code> field using a <a href="#MAV_FRAME">MAV_FRAME</a> value.</p><p>The global frames are prefixed with <code>MAV_FRAME_GLOBAL_*</code>. Mission items should use frame variants that have the suffix <code>_INT</code>: e.g. <code>MAV_FRAME_GLOBAL_RELATIVE_ALT_INT</code>, <code>MAV_FRAME_GLOBAL_INT</code>, <code>MAV_FRAME_GLOBAL_TERRAIN_ALT_INT</code>. When using these frames, latitude and longitude values must be encoded by multiplying the degrees by 1E7 (e.g. the latitude 69.69000000 would be sent as 69.69000000x1E7 = 696900000). Using int32 of degrees * 10^7 has higher resolution than could be achieved with single floating point.</p><p>A number of local frames are also specified. Local frame position values that are sent in integer field parameters must be encoded as <em>position in meters x 1E4</em> (e.g. 5m would be encoded and sent as 50000). If sent in messages <code>float</code> parameter fields the value should be sent as-is.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>Don&#39;t use the non-INT <em>global frames</em> in mission items (e.g. <code>MAV_FRAME_GLOBAL_RELATIVE_ALT</code>). These are intended to be used with messages that have <code>float</code> fields for positional information, e.g.: <code>MISSION_ITEM</code> (deprecated), <code>COMMAND_LONG</code>. If these frames are used, position values should be sent unencoded (i.e. no need to multiply by 1E7).</p></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>As above, in theory if a global <em>non-INT</em> frame variant is set for a <code>MISSION_ITEM_INT</code> the position value should be sent as-is (not encoded). This will result in the value being rounded when it is sent in the integer value, which will make the value unusable. In practice, many systems will assume you have encoded the value, but you should test this for your particular flight stack. Better just to use the correct frames!</p></div><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>Don&#39;t use <a href="./../messages/common.html#MAV_FRAME_MISSION">MAV_FRAME_MISSION</a> for mission items that contain positional data; this does not correspond to any particular real frame, and so will be ambiguous. <code>MAV_FRAME_MISSION</code> should be used for mission items that use params5 and param6 for other purposes.</p></div><h2 id="param-5-6-for-non-positional-data" tabindex="-1">Param 5, 6 For Non-Positional Data <a class="header-anchor" href="#param-5-6-for-non-positional-data" aria-label="Permalink to &quot;Param 5, 6 For Non-Positional Data&quot;">​</a></h2><p><code>Param5</code>, <code>param6</code>, <code>param7</code> may also be used for non-positional information. In this case the <a href="#MISSION_ITEM_INT">MISSION_ITEM_INT.frame</a> should be set to <a href="./../messages/common.html#MAV_FRAME_MISSION">MAV_FRAME_MISSION</a> (this is equivalent to say &quot;the frame data is irrelevant&quot;).</p><p>As param5 and param6 are sent in <em>integer</em> fields, generally you should design mission items/MAV_CMDs such that these only include integer data (and are sent as-is/unscaled). If these must be used for real numbers and scaling is required, then this must be noted in the mission item itself.</p><h2 id="operations" tabindex="-1">Operations <a class="header-anchor" href="#operations" aria-label="Permalink to &quot;Operations {#operations}&quot;">​</a></h2><p>This section defines all the protocol operations.</p><h3 id="detecting-mission-plan-changes" tabindex="-1">Detecting Mission/Plan Changes <a class="header-anchor" href="#detecting-mission-plan-changes" aria-label="Permalink to &quot;Detecting Mission/Plan Changes&quot;">​</a></h3><p>Mission upload and download can be expensive operations, in particular for large missions. A GCS can avoid unnecessary uploads and downloads by first checking whether it has a matching id(s) for the corresponding plan on the vehicle.</p><p>The current id for different parts of the plan are streamed in <a href="#MISSION_CURRENT">MISSION_CURRENT</a> message, using the appropriately named fields: <code>mission_id</code>, <code>fence_id</code>, <code>rally_points_id</code>. These values are <code>0</code> if there is no plan uploaded, or if detecting plan changes is not supported by the flight stack.</p><p>The IDs are generated by the flight stack when a new mission, rally point, or geofence, is <em>uploaded</em> to the vehicle (at which point it also starts publishing the value in <a href="#MISSION_CURRENT">MISSION_CURRENT</a>). MAVLink puts no particular requirements on <em>how</em> the &quot;opaque_id&quot; values are calculated by the flight stack (this is why they are named &quot;opaque&quot;). The only expectation is that the scheme used makes it unlikely that the GCS will incorrectly determine that it has a matching plan (a flight stack might use file hashes, plan checksums, pseudo-random numbers, or some other technique).</p><p>On upload, the generated ID is sent to the GCS in the final part of the upload sequence in the <a href="#MISSION_ACK">MISSION_ACK.opaque_id</a> field. On download, the stored ID is sent to the GCS in the <a href="#MISSION_COUNT">MISSION_COUNT.opaque_id</a> field.</p><p>The GCS should store the value of the ID from the flight stack as the &quot;current id&quot; for whatever part of the plan was uploaded/download. It can then monitor <code>MISSION_CURRENT</code>, and check its cached values against the current plan ids to determine whether it has a matching mission, or needs to download the mission from the vehicle.</p><h3 id="uploading_mission" tabindex="-1">Upload a Mission to the Vehicle <a class="header-anchor" href="#uploading_mission" aria-label="Permalink to &quot;Upload a Mission to the Vehicle {#uploading_mission}&quot;">​</a></h3><p>The diagram below shows the communication sequence to upload a mission to a drone (assuming all operations succeed).</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>Mission update must be robust! A new mission should be fully uploaded and accepted before the old mission is replaced/removed.</p></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>Mission upload/download can be bandwidth intensive and time consuming <a href="#detecting-missionplan-changes">Check for plan changes</a> before uploading (or downloading) a mission.</p></div><p><a href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtO1xuICAgIHBhcnRpY2lwYW50IEdDU1xuICAgIHBhcnRpY2lwYW50IERyb25lXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fQ09VTlRcbiAgICBHQ1MtPj5HQ1M6IFN0YXJ0IHRpbWVvdXRcbiAgICBEcm9uZS0-PkdDUzogTUlTU0lPTl9SRVFVRVNUX0lOVCAoMClcbiAgICBEcm9uZS0-PkRyb25lOiBTdGFydCB0aW1lb3V0XG4gICAgR0NTLS0-PkRyb25lOiBNSVNTSU9OX0lURU1fSU5UICgwKVxuICAgIE5vdGUgb3ZlciBHQ1MsRHJvbmU6IC4uLiBpdGVyYXRlIHRocm91Z2ggaXRlbXMgLi4uXG4gICAgRHJvbmUtPj5HQ1M6IE1JU1NJT05fUkVRVUVTVF9JTlQgKGNvdW50LTEpXG4gICAgRHJvbmUtPj5Ecm9uZTogU3RhcnQgdGltZW91dFxuICAgIEdDUy0tPj5Ecm9uZTogTUlTU0lPTl9JVEVNX0lOVCAoY291bnQtMSlcbiAgICBEcm9uZS0-PkdDUzogTUlTU0lPTl9BQ0siLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ" target="_blank" rel="noreferrer"><img src="https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtO1xuICAgIHBhcnRpY2lwYW50IEdDU1xuICAgIHBhcnRpY2lwYW50IERyb25lXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fQ09VTlRcbiAgICBHQ1MtPj5HQ1M6IFN0YXJ0IHRpbWVvdXRcbiAgICBEcm9uZS0-PkdDUzogTUlTU0lPTl9SRVFVRVNUX0lOVCAoMClcbiAgICBEcm9uZS0-PkRyb25lOiBTdGFydCB0aW1lb3V0XG4gICAgR0NTLS0-PkRyb25lOiBNSVNTSU9OX0lURU1fSU5UICgwKVxuICAgIE5vdGUgb3ZlciBHQ1MsRHJvbmU6IC4uLiBpdGVyYXRlIHRocm91Z2ggaXRlbXMgLi4uXG4gICAgRHJvbmUtPj5HQ1M6IE1JU1NJT05fUkVRVUVTVF9JTlQgKGNvdW50LTEpXG4gICAgRHJvbmUtPj5Ecm9uZTogU3RhcnQgdGltZW91dFxuICAgIEdDUy0tPj5Ecm9uZTogTUlTU0lPTl9JVEVNX0lOVCAoY291bnQtMSlcbiAgICBEcm9uZS0-PkdDUzogTUlTU0lPTl9BQ0siLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ" alt="Mission Upload Sequence"></a></p><p>In more detail, the sequence of operations is:</p><ol><li>GCS sends <a href="./../messages/common.html#MISSION_COUNT">MISSION_COUNT</a> including the number of mission items to be uploaded (<code>count</code>). <ul><li>A <a href="#timeout">timeout</a> must be started for the GCS to wait on the response from Drone (<code>MISSION_REQUEST_INT</code>).</li></ul></li><li>Drone receives message and responds with <a href="./../messages/common.html#MISSION_REQUEST_INT">MISSION_REQUEST_INT</a> requesting the first mission item (<code>seq==0</code>). <ul><li>A <a href="#timeout">timeout</a> must be started for the Drone to wait on the <code>MISSION_ITEM_INT</code> response from GCS.</li></ul></li><li>GCS receives <code>MISSION_REQUEST_INT</code> and responds with the requested mission item in a <a href="./../messages/common.html#MISSION_ITEM_INT">MISSION_ITEM_INT</a> message.</li><li>Drone and GCS repeat the <code>MISSION_REQUEST_INT</code>/<code>MISSION_ITEM_INT</code> cycle, iterating <code>seq</code> until all items are uploaded (<code>seq==count-1</code>).</li><li>After receiving the last mission item the drone responds with <a href="./../messages/common.html#MISSION_ACK">MISSION_ACK</a> with the <code>type</code> of <a href="./../messages/common.html#MAV_MISSION_ACCEPTED">MAV_MISSION_ACCEPTED</a> indicating mission upload completion/success. <ul><li>The drone should set the new mission to be the current mission, discarding the original data.</li><li>The drone considers the upload complete.</li></ul></li><li>GCS receives <code>MISSION_ACK</code> containing <code>MAV_MISSION_ACCEPTED</code> to indicate the operation is complete. <ul><li>The GCS should store <code>MISSION_ACK.opaque_id</code> (the current id of the uploaded plan) and can use it later to <a href="#detecting-missionplan-changes">check for plan changes</a>.</li></ul></li></ol><p>Notes:</p><ul><li>A <a href="#timeout">timeout</a> is set for every message that requires a response (e.g. <code>MISSION_REQUEST_INT</code>). If the timeout expires without a response being received then the request must be resent.</li><li>Mission items must be received in order. If an item is received out-of-sequence the expected item should be re-requested by the vehicle (the out-of-sequence item is dropped).</li><li>An <a href="#errors">error</a> can be signaled in response to any request using a <a href="./../messages/common.html#MISSION_ACK">MISSION_ACK</a> message containing an error code. This must cancel the operation and restore the mission to its previous state. For example, the drone might respond to the <a href="./../messages/common.html#MISSION_COUNT">MISSION_COUNT</a> request with a <a href="./../messages/common.html#MAV_MISSION_NO_SPACE">MAV_MISSION_NO_SPACE</a> if there isn&#39;t enough space to upload the mission.</li><li>The sequence above shows the <a href="#mavlink_commands">mission items</a> packaged in <a href="./../messages/common.html#MISSION_ITEM_INT">MISSION_ITEM_INT</a> messages. Protocol implementations must also support <a href="./../messages/common.html#MISSION_ITEM">MISSION_ITEM</a> and <a href="./../messages/common.html#MISSION_REQUEST">MISSION_REQUEST</a> in the same way.</li><li>Uploading an empty mission (<a href="./../messages/common.html#MISSION_COUNT">MISSION_COUNT</a> is 0) has the same effect as <a href="#clear_mission">clearing the mission</a>.</li></ul><h3 id="download_mission" tabindex="-1">Download a Mission from the Vehicle <a class="header-anchor" href="#download_mission" aria-label="Permalink to &quot;Download a Mission from the Vehicle {#download_mission}&quot;">​</a></h3><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>Mission upload/download can also be bandwidth intensive and time consuming. <a href="#detecting-missionplan-changes">Check for plan changes</a> before downloading (or uploading) a mission.</p></div><p>The diagram below shows the communication sequence to download a mission from a drone (assuming all operations succeed).</p><p><a href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtO1xuICAgIHBhcnRpY2lwYW50IEdDU1xuICAgIHBhcnRpY2lwYW50IERyb25lXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fUkVRVUVTVF9MSVNUXG4gICAgR0NTLT4-R0NTOiBTdGFydCB0aW1lb3V0XG4gICAgRHJvbmUtLT4-R0NTOiBNSVNTSU9OX0NPVU5UXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fUkVRVUVTVF9JTlQgKDApXG4gICAgR0NTLT4-R0NTOiBTdGFydCB0aW1lb3V0XG4gICAgRHJvbmUtLT4-R0NTOiBNSVNTSU9OX0lURU1fSU5UICgwKVxuICAgIE5vdGUgb3ZlciBHQ1MsRHJvbmU6IC4uLiBpdGVyYXRlIHRocm91Z2ggaXRlbXMgLi4uXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fUkVRVUVTVF9JTlQgKGNvdW50LTEpXG4gICAgR0NTLT4-R0NTOiBTdGFydCB0aW1lb3V0XG4gICAgRHJvbmUtLT4-R0NTOiBNSVNTSU9OX0lURU1fSU5UIChjb3VudC0xKVxuICAgIEdDUy0-PkRyb25lOiBNSVNTSU9OX0FDSyIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9" target="_blank" rel="noreferrer"><img src="https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtO1xuICAgIHBhcnRpY2lwYW50IEdDU1xuICAgIHBhcnRpY2lwYW50IERyb25lXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fUkVRVUVTVF9MSVNUXG4gICAgR0NTLT4-R0NTOiBTdGFydCB0aW1lb3V0XG4gICAgRHJvbmUtLT4-R0NTOiBNSVNTSU9OX0NPVU5UXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fUkVRVUVTVF9JTlQgKDApXG4gICAgR0NTLT4-R0NTOiBTdGFydCB0aW1lb3V0XG4gICAgRHJvbmUtLT4-R0NTOiBNSVNTSU9OX0lURU1fSU5UICgwKVxuICAgIE5vdGUgb3ZlciBHQ1MsRHJvbmU6IC4uLiBpdGVyYXRlIHRocm91Z2ggaXRlbXMgLi4uXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fUkVRVUVTVF9JTlQgKGNvdW50LTEpXG4gICAgR0NTLT4-R0NTOiBTdGFydCB0aW1lb3V0XG4gICAgRHJvbmUtLT4-R0NTOiBNSVNTSU9OX0lURU1fSU5UIChjb3VudC0xKVxuICAgIEdDUy0-PkRyb25lOiBNSVNTSU9OX0FDSyIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9" alt="Sequence: Download mission"></a></p><p>The sequence is similar to that for <a href="#uploading_mission">uploading a mission</a>. The main difference is that the client (e.g. GCS) sends <a href="./../messages/common.html#MISSION_REQUEST_LIST">MISSION_REQUEST_LIST</a>, which triggers the autopilot to respond with the current count of items (<a href="#MISSION_COUNT">MISSION_COUNT</a>). This starts a cycle where the GCS requests mission items, and the drone supplies them.</p><p>Note:</p><ul><li>The <a href="#MISSION_COUNT">MISSION_COUNT.opaque_id</a> is the stored ID of the part of the plan that is being uploaded from the vehicle. This should be stored by the GCS so that it can later check that its plan matches that on the vehicle.</li><li>A <a href="#timeout">timeout</a> is set for every message that requires a response (e.g. <code>MISSION_REQUEST_INT</code>). If the timeout expires without a response being received then the request must be resent.</li><li>Mission items must be received in order. If an item is received out-of-sequence the expected item should be re-requested by the GCS (the out-of-sequence item is dropped).</li><li>An <a href="#errors">error</a> can be signaled in response to any request using a <a href="./../messages/common.html#MISSION_ACK">MISSION_ACK</a> message containing an error code. This must cancel the operation.</li><li>The sequence above shows the <a href="#mavlink_commands">mission items</a> packaged in <a href="./../messages/common.html#MISSION_ITEM_INT">MISSION_ITEM_INT</a> messages. Protocol implementations must also support <a href="./../messages/common.html#MISSION_ITEM">MISSION_ITEM</a> and <a href="./../messages/common.html#MISSION_REQUEST">MISSION_REQUEST</a> in the same way.</li></ul><h3 id="current_mission_item" tabindex="-1">Set Current Mission Item <a class="header-anchor" href="#current_mission_item" aria-label="Permalink to &quot;Set Current Mission Item {#current_mission_item}&quot;">​</a></h3><p>The diagram below shows the communication sequence to set the current mission item.</p><p><a href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtO1xuICAgIHBhcnRpY2lwYW50IEdDU1xuICAgIHBhcnRpY2lwYW50IERyb25lXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fU0VUX0NVUlJFTlRcbiAgICBEcm9uZS0tPj5HQ1M6IE1JU1NJT05fQ1VSUkVOVCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9" target="_blank" rel="noreferrer"><img src="https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtO1xuICAgIHBhcnRpY2lwYW50IEdDU1xuICAgIHBhcnRpY2lwYW50IERyb25lXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fU0VUX0NVUlJFTlRcbiAgICBEcm9uZS0tPj5HQ1M6IE1JU1NJT05fQ1VSUkVOVCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9" alt="Mermaid Diagram: Set mission item"></a></p><p>In more detail, the sequence of operations is:</p><ol><li>GCS/App sends <a href="#MAV_CMD_DO_SET_MISSION_CURRENT">MAV_CMD_DO_SET_MISSION_CURRENT</a> (or <a href="#MISSION_SET_CURRENT">MISSION_SET_CURRENT</a>), specifying the new sequence number (<code>seq</code>).</li><li>Drone receives message and attempts to update the current mission sequence number. <ul><li>On success, the Drone must <em>broadcast</em> a <a href="./../messages/common.html#MISSION_CURRENT">MISSION_CURRENT</a> message containing the current sequence number (<code>seq</code>).</li><li>On failure, the Drone must <em>broadcast</em> a <a href="./../messages/common.html#STATUSTEXT">STATUSTEXT</a> with a <a href="./../messages/common.html#MAV_SEVERITY">MAV_SEVERITY</a> and a string stating the problem. This may be displayed in the UI of receiving systems.</li></ul></li></ol><p>Notes:</p><ul><li>There is no specific <a href="#timeout">timeout</a> on <code>MISSION_SET_CURRENT</code> message.</li><li>The acknowledgment of the message is via broadcast of mission/system status, which is not associated with the original message. This differs from <a href="#errors">error handling</a> in other operations. This approach is used because the success/failure is relevant to all mission-handling clients.</li></ul><h3 id="monitor_progress" tabindex="-1">Monitor Mission Progress <a class="header-anchor" href="#monitor_progress" aria-label="Permalink to &quot;Monitor Mission Progress {#monitor_progress}&quot;">​</a></h3><p>GCS/developer API can monitor progress by handling the appropriate messages sent by the drone:</p><ul><li>The vehicle must broadcast a <a href="./../messages/common.html#MISSION_ITEM_REACHED">MISSION_ITEM_REACHED</a> message whenever a new mission item is reached. The message contains the <code>seq</code> number of the current mission item.</li><li>The vehicle must also broadcast a <a href="./../messages/common.html#MISSION_CURRENT">MISSION_CURRENT</a> message if the <a href="#current_mission_item">current mission item</a> is changed.</li></ul><h3 id="clear_mission" tabindex="-1">Clear Missions <a class="header-anchor" href="#clear_mission" aria-label="Permalink to &quot;Clear Missions {#clear_mission}&quot;">​</a></h3><p>The diagram below shows the communication sequence to clear the mission from a drone (assuming all operations succeed).</p><p><a href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtO1xuICAgIHBhcnRpY2lwYW50IEdDU1xuICAgIHBhcnRpY2lwYW50IERyb25lXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fQ0xFQVJfQUxMXG4gICAgR0NTLT4-R0NTOiBTdGFydCB0aW1lb3V0XG4gICAgRHJvbmUtLT4-R0NTOiBNSVNTSU9OX0FDSyIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9" target="_blank" rel="noreferrer"><img src="https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtO1xuICAgIHBhcnRpY2lwYW50IEdDU1xuICAgIHBhcnRpY2lwYW50IERyb25lXG4gICAgR0NTLT4-RHJvbmU6IE1JU1NJT05fQ0xFQVJfQUxMXG4gICAgR0NTLT4-R0NTOiBTdGFydCB0aW1lb3V0XG4gICAgRHJvbmUtLT4-R0NTOiBNSVNTSU9OX0FDSyIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9" alt="Mermaid Diagram: Clear Missions"></a></p><p>In more detail, the sequence of operations is:</p><ol><li>GCS/API sends <a href="./../messages/common.html#MISSION_CLEAR_ALL">MISSION_CLEAR_ALL</a><ul><li>A <a href="#timeout">timeout</a> is started for the GCS to wait on <code>MISSION_ACK</code> from Drone.</li></ul></li><li>Drone receives the message, and clears the mission from storage.</li><li>Drone responds with <a href="./../messages/common.html#MISSION_ACK">MISSION_ACK</a> with result <code>type</code> of <a href="./../messages/common.html#MAV_MISSION_ACCEPTED">MAV_MISSION_ACCEPTED</a><a href="./../messages/common.html#MAV_MISSION_RESULT">MAV_MISSION_RESULT</a>.</li><li>GCS receives <code>MISSION_ACK</code> and clears its own stored information about the mission. The operation is now complete.</li></ol><p>Note:</p><ul><li>A <a href="#timeout">timeout</a> is set for every message that requires a response (e.g. <code>MISSION_CLEAR_ALL</code>). If the timeout expires without a response being received then the request must be resent.</li><li>An <a href="#errors">error</a> can be signaled in response to any request (in this case, just <code>MISSION_CLEAR_ALL</code>) using a <a href="./../messages/common.html#MISSION_ACK">MISSION_ACK</a> message containing an error code. This must cancel the operation. The GCS record of the mission (if any) should be retained.</li></ul><h3 id="cancel" tabindex="-1">Canceling Operations <a class="header-anchor" href="#cancel" aria-label="Permalink to &quot;Canceling Operations {#cancel}&quot;">​</a></h3><p>The above mission operations may be canceled by responding to any request (e.g. <code>MISSION_REQUEST_INT</code>) with a <code>MISSION_ACK</code> message containing the <code>MAV_MISSION_OPERATION_CANCELLED</code> error.</p><p>Both systems should then return themselves to the idle state (if the system does not receive the cancellation message it will resend the request; the recipient will then be in the idle state and may respond with an appropriate error for that state).</p><h3 id="operation-exceptions" tabindex="-1">Operation Exceptions <a class="header-anchor" href="#operation-exceptions" aria-label="Permalink to &quot;Operation Exceptions&quot;">​</a></h3><h4 id="timeout" tabindex="-1">Timeouts and Retries <a class="header-anchor" href="#timeout" aria-label="Permalink to &quot;Timeouts and Retries {#timeout}&quot;">​</a></h4><p>A timeout should be set for all messages that require a response. If the expected response is not received before the timeout then the message must be resent. If no response is received after a number of retries then the client must cancel the operation and return to an idle state.</p><p>The recommended timeout values before resending, and the number of retries are:</p><ul><li>Timeout (default): 1500 ms</li><li>Timeout (mission items): 250 ms.</li><li>Retries (max): 5</li></ul><h4 id="errors" tabindex="-1">Errors/Completion <a class="header-anchor" href="#errors" aria-label="Permalink to &quot;Errors/Completion {#errors}&quot;">​</a></h4><p>All operations complete with a <a href="./../messages/common.html#MISSION_ACK">MISSION_ACK</a> message containing the result of the operation (<a href="./../messages/common.html#MAV_MISSION_RESULT">MAV_MISSION_RESULT</a>) in the <code>type</code> field.</p><p>On successful completion, the message must contain <code>type</code> of <a href="./../messages/common.html#MAV_MISSION_ACCEPTED">MAV_MISSION_ACCEPTED</a>; this is sent by the system that is receiving the command/data (e.g. the drone for mission upload or the GCS for mission download).</p><p>An operation may also complete with an error - <code>MISSION_ACK.type</code> set to <a href="./../messages/common.html#MAV_MISSION_ERROR">MAV_MISSION_ERROR</a> or some other error code in <a href="./../messages/common.html#MAV_MISSION_RESULT">MAV_MISSION_RESULT</a>. This can occur in response to any message/anywhere in the sequence.</p><p>Errors are considered unrecoverable. In an error is sent, both ends of the system should reset themselves to the idle state and the current state of the mission on the vehicle should be unaltered.</p><p>Note:</p><ul><li><a href="#timeout">timeouts</a> are not considered errors.</li><li>Out-of-sequence messages in mission upload/download are recoverable, and are not treated as errors.</li></ul><h2 id="mission-file-formats" tabindex="-1">Mission File Formats <a class="header-anchor" href="#mission-file-formats" aria-label="Permalink to &quot;Mission File Formats&quot;">​</a></h2><p>The <em>defacto</em> standard file format for exchanging missions/plans is discussed in: <a href="./../file_formats/#mission_plain_text_file">File Formats &gt; Mission Plain-Text File Format</a>.</p><h2 id="mission-command-detail" tabindex="-1">Mission Command Detail <a class="header-anchor" href="#mission-command-detail" aria-label="Permalink to &quot;Mission Command Detail&quot;">​</a></h2><p>This section is for clarifications and additional information about common mission items. In particular it is intended for cases that are difficult to document in the specification XML, or when images will much better describe expected behaviour.</p><h3 id="loiter_commands" tabindex="-1">Loiter Commands (<code>MAV_CMD_NAV_LOITER_*</code>) <a class="header-anchor" href="#loiter_commands" aria-label="Permalink to &quot;Loiter Commands (`MAV_CMD_NAV_LOITER_*`) {#loiter_commands}&quot;">​</a></h3><p>Loiter commands are provided to allow a vehicle to hold at a location for a specified time or number of turns, until it reaches the specified altitude, or indefinitely. Multicopter vehicles stop at the specified point (within a <em>vehicle-specific</em> acceptance radius that is not set by the mission item). Forward-moving vehicles (e.g. fixed-wing) <em>circle</em> the point with the specified radius/direction.</p><p>The commands are:</p><ul><li><a href="./../messages/common.html#MAV_CMD_NAV_LOITER_TIME">MAV_CMD_NAV_LOITER_TIME</a> - Loiter at specified location for a given amount of time after reaching the location.</li><li><a href="./../messages/common.html#MAV_CMD_NAV_LOITER_TURNS">MAV_CMD_NAV_LOITER_TURNS</a> - Loiter at specified location for a given number of turns.</li><li><a href="https://mavlink.io/en/messages/common.html#MAV_CMD_NAV_LOITER_TO_ALT" target="_blank" rel="noreferrer">MAV_CMD_NAV_LOITER_TO_ALT</a> - Loiter at specified location until desired altitude is reached.</li><li><a href="./../messages/common.html#MAV_CMD_NAV_LOITER_UNLIM">MAV_CMD_NAV_LOITER_UNLIM</a> - Loiter at specified location for an unlimited amount of time, yawing to face a given direction.</li></ul><p>The location and fixed-wing loiter radius parameters are common to all commands:</p><table tabindex="0"><thead><tr><th>Param (:Label)</th><th>描述</th><th>Units</th></tr></thead><tbody><tr><td>3: Radius</td><td>Radius around waypoint. If positive loiter clockwise, else counter-clockwise</td><td>m</td></tr><tr><td>5: Latitude</td><td>Latitude</td><td></td></tr><tr><td>6: Longitude</td><td>Longitude</td><td></td></tr><tr><td>7: Altitude</td><td>Altitude</td><td>m</td></tr></tbody></table><p>The loiter time and turns are set in param 1 for the respective messages. The direction of loiter for <code>MAV_CMD_NAV_LOITER_UNLIM</code> can be set using <code>param4</code> (Yaw).</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>The remaining parameters (xtrack and heading) apply only to forward flying aircraft (not multicopters!)</p></div><p>Xtrack and heading define the location at which a forward flying (fixed wing) vehicle will <em>exit the loiter circle, and its path to the next waypoint</em> (these apply only to apply to only <code>MAV_CMD_NAV_LOITER_TIME</code> and <code>MAV_CMD_NAV_LOITER_TURNS</code>).</p><table tabindex="0"><thead><tr><th>Param (:Label)</th><th>描述</th><th>Units</th></tr></thead><tbody><tr><td>2: Heading Required</td><td>Leave loiter circle only once heading towards the next waypoint (0 = False)</td><td>min:0 max:1 increment:1</td></tr><tr><td>4: Xtrack Location</td><td>Sets xtrack path or exit location: 0 for the vehicle to converge towards the center xtrack when it leaves the loiter (the line between the centers of the current and next waypoint), 1 to converge to the direct line between the location that the vehicle exits the loiter radius and the next waypoint. Otherwise the angle (in degrees) between the tangent of the loiter circle and the center xtrack at which the vehicle must leave the loiter (and converge to the center xtrack). NaN to use the current system default xtrack behaviour.</td><td></td></tr></tbody></table><p>The recommended values (and resulting paths) are those shown below.</p><p><img src="'+t+'" alt="Loiter heading"></p><p>The vehicle leaves the loiter after it reaches the desired number of turns or time <em>and</em> based on <strong>both</strong> the <code>heading required</code> and <code>xtrack</code> params.</p><p>A <code>heading required</code> of <code>1</code> prevents the vehicle from exiting the loiter unless it is heading towards the next waypoint (if <code>0</code> it can leave at any point provided the other conditions are met). With this setting the vehicle can leave at any point in the arc shown, provided it meets the other conditions (e.g. xtrack). If necessary (i.e. it is not in the arc when the other conditions are met), the vehicle will loop back around the loiter before it evaluates the xtrack condition.</p><p><img src="'+i+'" alt="Loiter heading"></p><p>The Xtrack parameter independently defines the path and exit location:</p><ul><li><p><code>xtrack=0</code>: Exit the loiter circle and converge to the centre xtrack between this and the next waypoint.</p><ul><li>If the heading required parameter is not set it will exit the loiter immediately.</li><li>Otherwise it will leave as soon as it is heading towards the next waypoint (which may also be immediately!)</li></ul></li><li><p><code>xtrack=1</code>: Exit the loiter circle and fly/converge to the straight line between the exit point and the centre of the next waypoint (i.e. don&#39;t converge to the centre xtrack).</p><ul><li>If the heading required parameter is set it will exit the loiter as soon as it is heading towards the next waypoint (which may be immediately!).</li><li>If the heading required parameter is not set it will exit the loiter immediately (note that this exit path does not make much sense unless the heading parameter is set).</li></ul></li><li><p><code>xtrack=NaN</code>: Exit the loiter using &quot;system specific default behaviour&quot;.</p><ul><li>The vehicle must still respect the heading required param.</li><li>Usually this is synonymous with <code>xtrack=0</code></li></ul></li><li><p><code>xtrack=any other value</code>: Exit the loiter when the vehicle heading (tangent) makes the specified angle in degrees to the center xtrack. Converge to the center xtrack. The vehicle must still respect the <code>heading required</code> param (some xtrack values may not be possible with this condition true). This allows callers to specify how quickly the vehicle converges to the center xtrack. For example, the image below shows the vehicle exiting the loiter at 30 degrees.</p><p><img src="'+a+'" alt="Loiter angle"></p></li></ul><h2 id="implementations" tabindex="-1">Implementations <a class="header-anchor" href="#implementations" aria-label="Permalink to &quot;Implementations&quot;">​</a></h2><h3 id="px4" tabindex="-1">PX4 <a class="header-anchor" href="#px4" aria-label="Permalink to &quot;PX4&quot;">​</a></h3><p>The protocol has been implemented in C.</p><p>Source code:</p><ul><li><a href="https://github.com/PX4/Firmware/blob/master/src/modules/mavlink/mavlink_mission.cpp" target="_blank" rel="noreferrer">src/modules/mavlink/mavlink_mission.cpp</a></li></ul><p>The implementation status is (at time of writing):</p><ul><li>Flight plan missions: <ul><li>upload, download, clearing missions, and monitoring progress are supported as defined in this specification.</li></ul></li><li>Geofence missions&quot; are supported as defined in this specification.</li><li>Rally point &quot;missions&quot; are not supported on PX4.</li></ul><p>Mission operation cancellation works for mission download (sets system to idle). Mission operation cancellation does not work for mission uploading; PX4 resends <code>MISSION_REQUEST_INT</code> until the operation times out.</p><p>Source code:</p><ul><li><a href="https://github.com/PX4/Firmware/blob/master/src/modules/mavlink/mavlink_mission.cpp" target="_blank" rel="noreferrer">src/modules/mavlink/mavlink_mission.cpp</a></li></ul><h3 id="qgroundcontrol" tabindex="-1">QGroundControl <a class="header-anchor" href="#qgroundcontrol" aria-label="Permalink to &quot;QGroundControl&quot;">​</a></h3><p>The protocol has been implemented in C++.</p><p>Source code:</p><ul><li><a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/PlanManager.cc" target="_blank" rel="noreferrer">src/MissionManager/PlanManager.cc</a></li></ul><h3 id="ardupilot" tabindex="-1">ArduPilot <a class="header-anchor" href="#ardupilot" aria-label="Permalink to &quot;ArduPilot&quot;">​</a></h3><p>ArduPilot implements the mission protocol in C++.</p><p>ArduPilot uses the same messages and message flow described in this specification. There are (<em>anecdotally</em>) some implementation differences that affect compatibility. These are documented below.</p><p>Source:</p><ul><li><a href="https://github.com/ArduPilot/ardupilot/blob/master/libraries/GCS_MAVLink/GCS_Common.cpp" target="_blank" rel="noreferrer">/libraries/GCS_MAVLink/GCS_Common.cpp</a></li></ul><h4 id="flight-plan-missions" tabindex="-1">Flight Plan Missions <a class="header-anchor" href="#flight-plan-missions" aria-label="Permalink to &quot;Flight Plan Missions&quot;">​</a></h4><p>Mission upload, download, clearing missions, and monitoring progress are supported.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>ArduPilot implements also partial mission upload using <code>MISSION_WRITE_PARTIAL_LIST</code>, but not partial mission download (<code>MISSION_REQUEST_PARTIAL_LIST</code>). Partial mission upload/download is not an official/standardised part of the mission service.</p></div><p>ArduPilot&#39;s implementation differs from this specification (non-exhaustively):</p><ul><li>The first mission sequence number (<code>seq==0</code>) is populated with the home position of the vehicle instead of the first mission item.</li><li>Mission uploads are not &quot;atomic&quot;. An upload that fails (or is canceled) part-way through will not match the pre-update state. Instead it may be a mix of the original and new mission.</li><li>Even if upload is successful, the vehicle mission may not match the version on the uploading system (and if the mission is then downloaded it will differ from the original). <ul><li>There is rounding on some fields (and in some cases internal maximum possible values due to available storage space). Failures can occur if you do a straight comparison of the float params before/after upload.</li></ul></li><li>A <a href="#MISSION_ACK">MISSION_ACK</a> returning an error value (NACK) does not terminate the upload (i.e. it is not considered an unrecoverable error). As long as ArduPilot has not yet timed-out a system can retry the current mission item upload.</li><li>A mission cannot be cleared while it is being executed (i.e. while in Auto mode). Note that a new mission <em>can</em> be uploaded (even a zero-size mission - which is equivalent to clearing).</li><li>Explicit cancellation of operations is not supported. If one end stops communicating the other end will eventually timeout and reset itself to an idle/ready state.</li></ul><p>The following behaviour is not defined by the specification (but is still of interest):</p><ul><li>ArduPilot performs some validation of fields when mission items are submitted. The validation code is common to all vehicles; mission items that are not understood by the vehicle type are accepted on upload but skipped during mission execution.</li><li>ArduPilot preforms some vehicle-specific validation at mission runtime (e.g. of jump targets).</li><li>A new mission can be uploaded while a mission is being executed. In this case the current waypoint will be executed to completion even if the waypoint sequence is different in the new mission (to get the new item you would need to reset the sequence or switch in/out of auto mode).</li><li>ArduPilot missions are not stored in an SD card and therefore have a vehicle/board-specific maximum mission size (as a benefit, on ArduPilot, missions can survive SD card failure in flight).</li></ul><h4 id="geofence-rally-point-plans" tabindex="-1">Geofence &amp; Rally Point Plans <a class="header-anchor" href="#geofence-rally-point-plans" aria-label="Permalink to &quot;Geofence &amp; Rally Point Plans&quot;">​</a></h4><p>QGroundControl is the reference implementation for mission / rally point plans.</p>',144)]))}const _=o(d,[["render",l]]);export{g as __pageData,_ as default};
