import{_ as i,c as t,a8 as a,o as s}from"./chunks/framework.sDsl5pD6.js";const p=JSON.parse('{"title":"MAVLink 版本","description":"","frontmatter":{},"headers":[],"relativePath":"zh/guide/mavlink_version.md","filePath":"zh/guide/mavlink_version.md"}'),n={name:"zh/guide/mavlink_version.md"};function o(r,e,l,m,h,c){return s(),t("div",null,e[0]||(e[0]=[a('<h1 id="mavlink-版本" tabindex="-1">MAVLink 版本 <a class="header-anchor" href="#mavlink-版本" aria-label="Permalink to &quot;MAVLink 版本&quot;">​</a></h1><p>MAVLink 已部署在若干版本中：</p><ul><li><a href="./../guide/mavlink_2.html">MAVLink 2.0</a>: Current/recommended major version. 2017年初被主要用户采用。</li><li><em>MAVLink v1.0</em>: Widely adopted around 2013. 仍被许多传统的外围设备使用。</li></ul><p>The <em>MAVLink 2.0</em> C/C++ and Python libraries are backwards compatible with MAVLink 1.0 (support both protocols). <a href="#version_handshaking">Version Handshaking</a> and <a href="#negotiating_versions">Negotiating Versions</a> explain how to choose which version is used.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p><em>MAVLink v0.9</em> is a pre-release version that is no longer supported. The associated message set deleted in August 2018. Legacy code may be present in generator and test code.</p></div><h2 id="确定协议-消息版本" tabindex="-1">确定协议/消息版本 <a class="header-anchor" href="#确定协议-消息版本" aria-label="Permalink to &quot;确定协议/消息版本&quot;">​</a></h2><p>库的 MAVLink 支持可以通过多种方式来确定:</p><ul><li><p><a href="./../messages/common.html#AUTOPILOT_VERSION">AUTOPILOT_VERSION</a><code>.capabilities</code> can be checked against the <a href="./../messages/common.html#MAV_PROTOCOL_CAPABILITY_MAVLINK2">MAV_PROTOCOL_CAPABILITY_MAVLINK2</a> flag to verify MAVLink 2 support.</p></li><li><p>主要版本可以从数据包起始标记字节中确定:</p><ul><li>MAVLink 1: <code>0xFE</code></li><li>MAVLink 2: <code>0xFD</code></li></ul><div class="info custom-block"><p class="custom-block-title">INFO</p><p>A MAVLink library that does not support a protocol version will not recognise the protocol start marker; so no messages will even be detected (see <a href="./../guide/serialization.html">Serialization</a>).</p></div></li><li><p><a href="./../messages/common.html#HEARTBEAT">HEARTBEAT</a><code>.mavlink_version</code> field contains the minor version number. This is the <code>&lt;version&gt;</code> field defined in the <a href="./../messages/">Message Definitions</a> (<code>version</code> in <a href="./../messages/common.html">common.xml</a> for dialects that depend on the common message set).</p></li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>While messages do not contain version information, an extra CRC is used to ensure that a library will only process compatible messages (see <a href="./../guide/serialization.html">Serialization &gt; CRC_EXTRA</a>).</p></div><h2 id="version_handshaking" tabindex="-1">Version Handshaking <a class="header-anchor" href="#version_handshaking" aria-label="Permalink to &quot;Version Handshaking {#version_handshaking}&quot;">​</a></h2><p>Support for <em>MAVLink 2</em> is indicated in the <a href="./../messages/common.html#AUTOPILOT_VERSION">AUTOPILOT_VERSION</a> message by the <a href="./../messages/common.html#MAV_PROTOCOL_CAPABILITY_MAVLINK2">MAV_PROTOCOL_CAPABILITY_MAVLINK2</a> flag. It can also be inferred from the packet start marker byte.</p><p>如果自动驾驶仪和 gcs 之间的通信链接是完全透明的, 这就足够了。 Most flight stacks now assume MAVLink 2 support based on the protocol capability or packet start marker. This is reasonable because the majority of systems and communication links now reliably support MAVLink 2.</p><h3 id="non-transparent-communication-links" tabindex="-1">Non-transparent communication links <a class="header-anchor" href="#non-transparent-communication-links" aria-label="Permalink to &quot;Non-transparent communication links&quot;">​</a></h3><p>Most flight stacks assume communication links are transparent. Possible causes of links not being transparent are:</p><ul><li>Routing, which can can change or reserialize MAVLink packets (for example, there might be an intermediate router that converts between versions).</li><li>Wireless links that rely on fixed length packetization may distort or truncate variable-length MAVLink 2 frames. For example, older SiK Radios may consume MAVLink 2 messages.</li></ul><p>To be certain that a link supports <em>MAVLink 2</em> transparently, a GCS or other component might send the <a href="./../messages/common.html#MAV_CMD_REQUEST_MESSAGE">MAV_CMD_REQUEST_MESSAGE</a> command with <code>param1</code> set to the id of a <em>MAVLink 2</em> message (with <code>id &gt; 256</code>) that is supported by the flight stack. If the system supports <em>MAVLink 2</em> and the handshake it will respond with the message <strong>encoded as MAVLink 2 packet</strong>. If it does not support <em>MAVLink 2</em> it should <code>NACK</code> the command. 如果命令接口未得到适当执行，GCS应返回超时。</p><p>The diagram below illustrates the sequence.</p><p><a href="https://mermaid.live/edit#pako:eNptUV1rwjAU_SvhPm3QiU0_dBkTpBYR7cbWbQ-jUEJ7W8Ns4mK6L_G_Lyq6sZmHS-4595xzSdZQqBKBwQpfW5QFjgSvNW-uMknsWXJtRCGWXBoyjtL_4EgriXvY8heDwQ5gJBk-5VEyyu_ju8c4fciTOE2H4_jMannjkmsiSqIqkt4mcW5nZ5ObKT0Mnf_2s5WR1NhIYkSDqjV7dpdz5E_ZECG3a8yEfCGUVDZXyPrEqpOKDKOpNXkXppjjihj1ozsVdmqOKEk0FijeEByotSiBGd2iAw3qhm9bWG_NMjBzbDADZq8lVrxdmAwyubEy-6LPSjUHpVZtPQdW8cXKdu2y5ObwPX_QuBRG6SOoUZaoI9VKA8yj3Z0zsDV8APMvw06v5_Wp6_X8IHCpA5_AbNfxe37Xp7RLA9f1Ng587VbpdkLfC_t-2A-oZ7nA3XwDTR6tNw" target="_blank" rel="noreferrer"><img src="https://mermaid.ink/img/pako:eNptUV1rwjAU_SvhPm3QiU0_dBkTpBYR7cbWbQ-jUEJ7W8Ns4mK6L_G_Lyq6sZmHS-4595xzSdZQqBKBwQpfW5QFjgSvNW-uMknsWXJtRCGWXBoyjtL_4EgriXvY8heDwQ5gJBk-5VEyyu_ju8c4fciTOE2H4_jMannjkmsiSqIqkt4mcW5nZ5ObKT0Mnf_2s5WR1NhIYkSDqjV7dpdz5E_ZECG3a8yEfCGUVDZXyPrEqpOKDKOpNXkXppjjihj1ozsVdmqOKEk0FijeEByotSiBGd2iAw3qhm9bWG_NMjBzbDADZq8lVrxdmAwyubEy-6LPSjUHpVZtPQdW8cXKdu2y5ObwPX_QuBRG6SOoUZaoI9VKA8yj3Z0zsDV8APMvw06v5_Wp6_X8IHCpA5_AbNfxe37Xp7RLA9f1Ng587VbpdkLfC_t-2A-oZ7nA3XwDTR6tNw?type=png" alt="Mermaid sequence: Check protocol version"></a></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Historically the message used for testing was <code>PROTOCOL_VERSION</code>, which is now deprecated. The protocol should work with any other MAVLink 2 telemetry message supported by the flight stack.</p></div><h3 id="半透明的传输" tabindex="-1">半透明的传输 <a class="header-anchor" href="#半透明的传输" aria-label="Permalink to &quot;半透明的传输&quot;">​</a></h3><p>Some popular legacy radios (e.g. the SiK radio series) operate in semi-transparent mode by injecting <a href="./../messages/common.html#RADIO_STATUS">RADIO_STATUS</a> messages into the MAVLink message stream. Per MAVLink spec these should actually emit a heartbeat with the same system ID and a different component ID than the autopilot to be discoverable. However, an additional heartbeat could be an issue for deployed systems. Therefore these radios can alternatively confirm their <em>MAVLink 2</em> compliance by emitting <code>RADIO_STATUS</code> in v2 message format after receiving the first MAVLink v2 frame.</p><h2 id="版本和签名" tabindex="-1">版本和签名 <a class="header-anchor" href="#版本和签名" aria-label="Permalink to &quot;版本和签名&quot;">​</a></h2><p>The supported MAVLink library implementations enable different MAVLink versions on a per-channel basis, where a <em>channel</em> refers to a particular link in/out of a MAVLink system or component (e.g. a serial port or UDP port).</p><p>As a result, all <a href="./../services/heartbeat.html">connections</a> to other components over a particular channel must share the same MAVLink version. If a system is using signing, then all connections via the same channel must also be signing messages with the same key.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>A system cannot use a single channel to connect to signed MAVLink 2 systems, unsigned MAVLink 2 systems, and/or MAVLink 1 components.</p></div><p>Currently most MAVLink networks are configured to use unsigned MAVLink 2 messages. MAVLink 1 is primarily used to allow autopilots to connect to legacy MAVLink peripherals, and this is done via a separate channel. Signed networks will need to use a further separate channel to connect to other signed systems.</p><p>The next section explains how a system/channel should negotiate the version to use.</p><h2 id="negotiating_versions" tabindex="-1">Negotiating Versions <a class="header-anchor" href="#negotiating_versions" aria-label="Permalink to &quot;Negotiating Versions {#negotiating_versions}&quot;">​</a></h2><p>Vehicle and GCS implementations will support both <em>MAVLink 1</em> and <em>MAVLink 2</em> for quite some time. We would like most users to receive the benefit of <em>MAVLink 2</em>, while still supporting implementations that don&#39;t yet support <em>MAVLink 2</em>.</p><p>The following is meant to capture best practice for vehicle firmware and GCS authors:</p><ul><li>Vehicle implementations should have a way to enable/disable the sending of <em>MAVLink 2</em> messages. This should preferably be on a per-link (channel) basis to allow for some peripherals to be <em>MAVLink 1</em> while others are <em>MAVLink 2</em>. 此选项要求重新启动飞行控制器才能生效是可以接受的。</li><li>If signing is enabled then the vehicle should immediately start sending <em>signed</em> <em>MAVLink 2</em> on startup.</li><li>If signing is not enabled and <em>MAVLink 2</em> is enabled then the vehicle may choose to start by sending <em>MAVLink 1</em> and switch to <em>MAVLink 2</em> on a link when it first receives a <em>MAVLink 2</em> message on the link.</li><li>Vehicles should set the <code>MAV_PROTOCOL_CAPABILITY_MAVLINK2</code> capability flag in the <code>AUTOPILOT_VERSION</code> message if <em>MAVLink 2</em> is available on a link. This should be set in the case where the link is currently sending <em>MAVLink 1</em> packets but <em>MAVLink 2</em> packets will be accepted and will cause a switch to <em>MAVLink 2</em>.</li><li>GCS implementations can choose to either automatically switch to <em>MAVLink 2</em> where available or to have a configuration option for <em>MAVLink 2</em>.</li><li>If the GCS chooses to use a configuration option then when the option is enabled it should send <em>MAVLink 2</em> on starting the link.</li><li>If the GCS chooses to use automatic switching then it should switch to sending <em>MAVLink 2</em> if either it receives a <em>MAVLink 2</em> message on the link or by asking for the <code>AUTOPILOT_VERSION</code> message to be sent and seeing the <code>MAV_PROTOCOL_CAPABILITY_MAVLINK2</code> flag is set.</li></ul>',31)]))}const k=i(n,[["render",o]]);export{p as __pageData,k as default};
